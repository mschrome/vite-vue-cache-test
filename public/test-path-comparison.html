<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>è·¯å¾„æ–¹å¼å¯¹æ¯”æµ‹è¯•</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      padding: 20px;
    }
    
    .container {
      max-width: 1400px;
      margin: 0 auto;
    }
    
    .header {
      background: white;
      padding: 30px;
      border-radius: 10px;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
      margin-bottom: 30px;
      text-align: center;
    }
    
    .header h1 {
      color: #667eea;
      margin-bottom: 10px;
    }
    
    .comparison {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 20px;
      margin-bottom: 20px;
    }
    
    .test-column {
      background: white;
      padding: 25px;
      border-radius: 10px;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
    }
    
    .test-column h2 {
      color: #667eea;
      margin-bottom: 15px;
      display: flex;
      align-items: center;
      gap: 10px;
    }
    
    .badge {
      padding: 4px 12px;
      border-radius: 20px;
      font-size: 12px;
      font-weight: 600;
    }
    
    .badge-recommended {
      background: #10b981;
      color: white;
    }
    
    .badge-test {
      background: #f59e0b;
      color: white;
    }
    
    .button-group {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 10px;
      margin: 15px 0;
    }
    
    button {
      padding: 12px 20px;
      border: none;
      border-radius: 8px;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      font-size: 14px;
      cursor: pointer;
      transition: all 0.3s ease;
    }
    
    button:hover {
      transform: translateY(-2px);
      box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
    }
    
    .result-box {
      margin-top: 15px;
      padding: 15px;
      border-radius: 8px;
      background: #f8f9fa;
      min-height: 100px;
    }
    
    .success {
      color: #10b981;
      font-weight: 600;
      margin-bottom: 10px;
    }
    
    .error {
      color: #ef4444;
      font-weight: 600;
      margin-bottom: 10px;
    }
    
    .loading {
      text-align: center;
      color: #667eea;
    }
    
    pre {
      background: #2d3748;
      color: #e2e8f0;
      padding: 15px;
      border-radius: 5px;
      overflow-x: auto;
      font-size: 13px;
      line-height: 1.5;
      margin: 10px 0;
    }
    
    code {
      background: #e2e8f0;
      padding: 2px 6px;
      border-radius: 3px;
      font-size: 13px;
      color: #e74c3c;
    }
    
    details {
      margin: 10px 0;
      border: 1px solid #e2e8f0;
      border-radius: 5px;
      padding: 10px;
    }
    
    summary {
      cursor: pointer;
      font-weight: 600;
      color: #667eea;
    }
    
    .info-box {
      background: #eff6ff;
      border-left: 4px solid #3b82f6;
      padding: 15px;
      border-radius: 5px;
      margin-bottom: 20px;
    }
    
    @media (max-width: 768px) {
      .comparison {
        grid-template-columns: 1fr;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <h1>ğŸ”¬ è·¯å¾„æ–¹å¼å¯¹æ¯”æµ‹è¯•</h1>
      <p>URL å¯¹è±¡ vs å­—ç¬¦ä¸²è·¯å¾„ - å®é™…æ•ˆæœå¯¹æ¯”</p>
    </div>

    <div class="info-box">
      <strong>ğŸ“š æµ‹è¯•è¯´æ˜ï¼š</strong>
      <ul style="margin-top: 10px; padding-left: 20px;">
        <li><strong>å·¦ä¾§ï¼ˆURL å¯¹è±¡ï¼‰</strong>ï¼šä½¿ç”¨ <code>new URL('../assets/file', import.meta.url)</code> - æ¨èæ–¹å¼</li>
        <li><strong>å³ä¾§ï¼ˆå­—ç¬¦ä¸²è·¯å¾„ï¼‰</strong>ï¼šä½¿ç”¨ <code>readFileSync('../../assets/file')</code> - å¯¹æ¯”æµ‹è¯•</li>
        <li>ç‚¹å‡»ç›¸åŒçš„æŒ‰é’®ï¼Œå¯¹æ¯”ä¸¤ç§æ–¹å¼çš„ç»“æœå·®å¼‚</li>
      </ul>
    </div>

    <div class="comparison">
      <!-- å·¦åˆ—ï¼šURL å¯¹è±¡æ–¹å¼ -->
      <div class="test-column">
        <h2>
          ğŸ“ URL å¯¹è±¡æ–¹å¼
          <span class="badge badge-recommended">æ¨è</span>
        </h2>
        <p style="color: #666; margin-bottom: 15px; font-size: 14px;">
          ä½¿ç”¨ <code>new URL()</code> + <code>import.meta.url</code>
        </p>
        <div class="button-group">
          <button onclick="testURL('config.json')">config.json</button>
          <button onclick="testURL('data.md')">data.md</button>
          <button onclick="testURL('secret.txt')">secret.txt</button>
          <button onclick="testURL('metadata.json')">metadata.json</button>
        </div>
        <div id="result-url" class="result-box"></div>
      </div>

      <!-- å³åˆ—ï¼šå­—ç¬¦ä¸²è·¯å¾„æ–¹å¼ -->
      <div class="test-column">
        <h2>
          ğŸ“ å­—ç¬¦ä¸²è·¯å¾„æ–¹å¼
          <span class="badge badge-test">æµ‹è¯•</span>
        </h2>
        <p style="color: #666; margin-bottom: 15px; font-size: 14px;">
          ä½¿ç”¨ <code>readFileSync('../../assets/file')</code>
        </p>
        <div class="button-group">
          <button onclick="testString('config.json')">config.json</button>
          <button onclick="testString('data.md')">data.md</button>
          <button onclick="testString('secret.txt')">secret.txt</button>
          <button onclick="testString('metadata.json')">metadata.json</button>
        </div>
        <div id="result-string" class="result-box"></div>
      </div>
    </div>
  </div>

  <script>
    function escapeHtml(text) {
      const div = document.createElement('div');
      div.textContent = text;
      return div.innerHTML;
    }

    // æµ‹è¯• URL å¯¹è±¡æ–¹å¼
    async function testURL(fileName) {
      const resultDiv = document.getElementById('result-url');
      resultDiv.innerHTML = '<div class="loading">â³ æµ‹è¯•ä¸­...</div>';
      
      try {
        const url = `/test-included-files?file=${fileName}`;
        const response = await fetch(url);
        const data = await response.json();
        
        resultDiv.innerHTML = renderResult(data, fileName, 'URL å¯¹è±¡');
      } catch (error) {
        resultDiv.innerHTML = `<div class="error">âŒ è¯·æ±‚å¤±è´¥: ${error.message}</div>`;
      }
    }

    // æµ‹è¯•å­—ç¬¦ä¸²è·¯å¾„æ–¹å¼
    async function testString(fileName) {
      const resultDiv = document.getElementById('result-string');
      resultDiv.innerHTML = '<div class="loading">â³ æµ‹è¯•ä¸­...</div>';
      
      try {
        const url = `/test-string-path?file=${fileName}`;
        const response = await fetch(url);
        const data = await response.json();
        
        resultDiv.innerHTML = renderResult(data, fileName, 'å­—ç¬¦ä¸²è·¯å¾„');
      } catch (error) {
        resultDiv.innerHTML = `<div class="error">âŒ è¯·æ±‚å¤±è´¥: ${error.message}</div>`;
      }
    }

    // æ¸²æŸ“ç»“æœ
    function renderResult(data, fileName, method) {
      let html = '<div class="result-content">';
      html += `<h3 style="color: #667eea; margin-bottom: 10px;">ğŸ“„ ${fileName}</h3>`;
      
      if (data.success) {
        html += '<div class="success">âœ… æˆåŠŸè¯»å–æ–‡ä»¶</div>';
        html += `<p><strong>æ–¹å¼:</strong> ${method}</p>`;
        html += `<p><strong>æ–‡ä»¶è·¯å¾„:</strong></p>`;
        html += `<code style="display: block; margin: 5px 0; word-break: break-all;">${data.filePath}</code>`;
        
        if (data.fileUrl) {
          html += `<p style="margin-top: 10px;"><strong>æ–‡ä»¶ URL:</strong></p>`;
          html += `<code style="display: block; margin: 5px 0; word-break: break-all; font-size: 11px;">${data.fileUrl}</code>`;
        }
        
        if (data.processCwd) {
          html += `<p style="margin-top: 10px;"><strong>process.cwd():</strong></p>`;
          html += `<code style="display: block; margin: 5px 0; word-break: break-all;">${data.processCwd}</code>`;
        }
        
        html += `<p style="margin-top: 10px;"><strong>æ–‡ä»¶å¤§å°:</strong> ${data.fileSize} å­—èŠ‚</p>`;
        html += `<p><strong>å†…å®¹ç±»å‹:</strong> ${data.contentType}</p>`;
        
        html += '<details style="margin-top: 10px;"><summary>ğŸ“„ æ–‡ä»¶å†…å®¹</summary>';
        html += `<pre>${escapeHtml(data.content.substring(0, 500))}${data.content.length > 500 ? '...' : ''}</pre>`;
        html += '</details>';
      } else {
        html += '<div class="error">âŒ è¯»å–å¤±è´¥</div>';
        html += `<p><strong>æ–¹å¼:</strong> ${method}</p>`;
        html += `<p><strong>é”™è¯¯:</strong> ${data.error}</p>`;
        
        if (data.processCwd) {
          html += `<p style="margin-top: 10px;"><strong>process.cwd():</strong></p>`;
          html += `<code style="display: block; margin: 5px 0; word-break: break-all;">${data.processCwd}</code>`;
        }
        
        if (data.searchedPaths) {
          html += '<details open style="margin-top: 10px;"><summary>ğŸ” å°è¯•çš„è·¯å¾„ (' + data.searchedPaths.length + ' ä¸ª)</summary>';
          html += '<ul style="margin: 10px 0; padding-left: 20px; font-size: 13px;">';
          data.searchedPaths.forEach(path => {
            html += `<li style="margin: 5px 0; word-break: break-all;"><code>${escapeHtml(path)}</code></li>`;
          });
          html += '</ul></details>';
        }
        
        html += `<p style="color: #e67e22; margin-top: 10px;"><strong>ğŸ’¡ æç¤º:</strong> ${data.message || data.tip}</p>`;
      }
      
      html += '</div>';
      return html;
    }

    // é¡µé¢åŠ è½½å®Œæˆæç¤º
    window.addEventListener('load', () => {
      console.log('âœ… é¡µé¢åŠ è½½å®Œæˆ');
      console.log('ğŸ’¡ ç‚¹å‡»æŒ‰é’®å¼€å§‹æµ‹è¯•');
    });
  </script>
</body>
</html>
